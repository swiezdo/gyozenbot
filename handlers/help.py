# /gyozenbot/handlers/help.py
import logging
from aiogram import Router
from aiogram.filters import Command
from aiogram.types import Message

router = Router()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logger = logging.getLogger(__name__)


def _format_help_text() -> str:
    """
    –§–æ—Ä–º–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç —Å–ø—Ä–∞–≤–∫–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.
    
    Returns:
        str: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å–ø—Ä–∞–≤–∫–∏ –≤ HTML —Ñ–æ—Ä–º–∞—Ç–µ
    """
    help_text = """<b>üìñ –°–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞</b>

<b>–ö–æ–º–∞–Ω–¥—ã —Å –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –∑–Ω–∞–∫–æ–º:</b>

<b>!–≤–æ–ª–Ω—ã</b>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫—Ä–∏–Ω—à–æ—Ç —Å–ø–∏—Å–∫–∞ –≤–æ–ª–Ω –¥–ª—è –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ "–ö–æ—à–º–∞—Ä" –¥–ª—è —Ç–µ–∫—É—â–µ–π –Ω–µ–¥–µ–ª–∏.

<b>!–ø</b>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ <code>!–ø</code> - –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å
‚Ä¢ –û—Ç–≤–µ—Ç—å—Ç–µ <code>!–ø</code> –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ - –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å –∞–≤—Ç–æ—Ä–∞ —Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

<b>!–±–∞–ª–∞–Ω—Å</b>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ú–∞–≥–∞—Ç–∞–º–∞ ü™ô
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ <code>!–±–∞–ª–∞–Ω—Å</code> - –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à –±–∞–ª–∞–Ω—Å
‚Ä¢ –û—Ç–≤–µ—Ç—å—Ç–µ <code>!–±–∞–ª–∞–Ω—Å</code> –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ - –ø–æ–∫–∞–∂–µ—Ç –±–∞–ª–∞–Ω—Å –∞–≤—Ç–æ—Ä–∞ —Ç–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

<b>–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏–≥—Ä–æ–∫–æ–≤:</b>

<b>!–≥–∞–ª–æ—á–∫–∏</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –≤ –∏–≥—Ä–µ (–ì–ª–∞–≤—ã, —Å—é–∂–µ—Ç, –≤—ã–∂–∏–≤–∞–Ω–∏–µ –∏ —Ç.–¥)
<b>!—Å–ø–∏–¥—Ä–∞–Ω</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ "–ö–æ—à–º–∞—Ä" –Ω–∞ –≤—Ä–µ–º—è.
<b>!–Ω–∞–±–µ–≥</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ª—é–±–æ–π –∏–ª–∏ –≤—Å–µ—Ö –≥–ª–∞–≤ –ø–æ–≤–µ—Å—Ç–∏ –æ–± –ò—ë.
<b>!–ø—Ä–∏–∑—Ä–∞–∫</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —á–µ–≥–æ —É–≥–æ–¥–Ω–æ –≤ –∏–≥—Ä–µ, —ç—Ç–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ç–µ—Ö, –∫–æ–º—É –±–µ–∑ —Ä–∞–∑–Ω–∏—Ü—ã –≤ –∫–∞–∫–æ–π —Ä–µ–∂–∏–º –∏–≥—Ä–∞—Ç—å –∏ –Ω–∞ –∫–∞–∫–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
<b>!—Ö–º</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –≤—ã–∂–∏–≤–∞–Ω–∏—è –≤ —Ä–µ–∂–∏–º–µ HellMode (–ü–ª–∞—Ç–∏–Ω–∞ —Å 7-—é –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏).
<b>!—Å—é–∂–µ—Ç</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Å—é–∂–µ—Ç–Ω—ã—Ö –º–∏—Å—Å–∏–π –Ω–∞ –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
<b>!—Å–æ–ø–µ—Ä–Ω–∏–∫–∏</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –°–æ–ø–µ—Ä–Ω–∏–∫–∏ –Ω–∞ –ª—é–±–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.
<b>!–∏—Å–ø—ã—Ç–∞–Ω–∏—è</b>
–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ò—Å–ø—ã—Ç–∞–Ω–∏–π –ò—ë.

–≠—Ç–∏ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–º–µ "üéÆ –ü–æ–∏—Å–∫ —Ç–∏–º–º–µ–π—Ç–æ–≤"


<b>–ö–æ–º–∞–Ω–¥—ã —Å–æ —Å–ª–µ—à–µ–º:</b>

<code>/build</code> –∏–ª–∏ <code>/–±–∏–ª–¥ &lt;ID&gt;</code>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –±–∏–ª–¥ –ø–æ —É–∫–∞–∑–∞–Ω–Ω–æ–º—É ID.
–ü—Ä–∏–º–µ—Ä: <code>/build 12</code> –∏–ª–∏ <code>/–±–∏–ª–¥ 12</code>

<code>/notifications</code>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
‚Ä¢ –ù–∞–ø–∏—à–∏—Ç–µ <code>/notifications</code> –≤ –ª–∏—á–∫—É –±–æ—Ç–∞ - –ø–æ–∫–∞–∂–µ—Ç –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –ª–∏—á–∫–µ —Å –±–æ—Ç–æ–º.

<code>/help</code>
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É."""
    
    return help_text


@router.message(Command("help"))
async def help_command(message: Message):
    """
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /help - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –≤—Å–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞.
    """
    logger.info(f"–û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /help –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {message.from_user.id}")
    
    try:
        help_text = _format_help_text()
        await message.answer(help_text, parse_mode="HTML")
        logger.info("–°–ø—Ä–∞–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é %s", message.from_user.id)
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–æ–º–∞–Ω–¥—ã /help: {str(e)}", exc_info=True)
        await message.reply("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ —Å–ø—Ä–∞–≤–∫–∏")

